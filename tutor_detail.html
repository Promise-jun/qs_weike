<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>情说微课-音频专栏</title>
	<meta name = "viewport" content = "width = device-width, initial-scale = 1.0, maximum-scale = 1.0, user-scalable = 0" />
	<script type="text/javascript">
	    (function (doc, win) {
	      	var docEl = doc.documentElement,
	     	resizeEvt = 'orientationchange' in window
	        	? 'orientationchange'
	        	: 'resize',
	      	recalc = function () {
	        	var clientWidth = docEl.clientWidth
	        	if (!clientWidth) return
	       		docEl.style.fontSize = clientWidth / 18.75 + 'px'
	      	}
      		if (!doc.addEventListener) return
      		win.addEventListener(resizeEvt, recalc, false)
      		doc.addEventListener('DOMContentLoaded', recalc, false)
	    })(document, window)
	</script>
	<!-- head 中 -->
	<link rel="stylesheet" type="text/css" href="./css/weui.min.css">
	<link rel="stylesheet" type="text/css" href="./css/jquery-weui.min.css">
	<link rel="stylesheet" type="text/css" href="./css/mescroll.css">
	<link rel="stylesheet" type="text/css" href="./css/swiper.min.css">
	<link rel="stylesheet" type="text/css" href="./css/qs_weike.css">
	<style type="text/css">
	 	#dataList {
	 		overflow: hidden;
	 	}
	 	.loadMore_box {
	 		display: none;
	 		padding-bottom: 10px;
	 		text-align: center;
	 	}
	 	.loadMore {
	 		font-size: 12px;
	 		color: #FD7A60;
	 	}
	 	.tutor_detail .magazine .weui-cell {
	 		padding: 15px 0;
	 	}
	 	.top_tab .line_box .twoTab {
	 		width: 8%;
	 		left: 21%;
	 	}
	 </style>
</head>
<body>
	<div class="top_fixed">
		<div class="weui-flex top_box">
		  	<div class="weui-flex__item">
		  		<span id="tutorName"></span>
		  		<a href="javascript:;" class="back"></a>
		  		<a href="javascript:;" class="share"></a>
		  	</div>
		</div>
	</div>
	<div class="container tutor_detail">
		<div class="binner"><img src="images/icon_background.png"></div>
		<div class="tutor_info">
			<div class="tutor_head">
				<img src="images/timg-head.jpg" alt="">
				<a href="javascript:;" class="tutor_audio"></a>
			</div>
			<div class="tutor_data">
				<p>
					<span class="name">杨蕾</span>
					<!-- 女：sex_woman   男：sex_man -->
					<span class="sex_woman"></span>
					<!-- 在线：on_line  离线：off_line -->
					<span class="on_line"></span>
				</p>
				<p>
					<span class="location">浙江 杭州</span>
					<span class="grade">评分 5.0 </span>
				</p>
			</div>
		</div>
		<div class="weui-flex tutor_num">
		  	<div class="weui-flex__item">
		  		<p class="num">256</p>
		  		<p class="tool">已咨询人数</p>
		  	</div>
		  	<div class="weui-flex__item">
		  		<p class="num">2478</p>
		  		<p class="tool">粉丝</p>
		  	</div>
		  	<div class="weui-flex__item">
		  		<p class="num">129</p>
		  		<p class="tool">收到感谢</p>
		  	</div>
		</div>

		<div class="margin_num"></div>

		<!-- 相册 -->
		<div class="tutor_pic">
			<p class="title">相册</p>
			<div class="swiper-container pic_swiper">
				 <div class="swiper-wrapper">
		            <div class="swiper-slide">
		            	<img src="images/timg-head.jpg">
		            </div>
		            <div class="swiper-slide">
		            	<img src="images/bg.jpg">
		            </div>
		            <div class="swiper-slide">
		            	<img src="images/timg2.jpg">
		            </div>
		             <div class="swiper-slide">
		            	<img src="images/rule_case2.png">
		            </div>
		        </div>
			</div>
		</div>

		<div class="weui-flex top_tab">
		  	<div class="weui-flex__item active_tab" i="0">介绍</div>
		  	<!-- <div class="weui-flex__item" i="1">课程</div> -->
		  	<div class="weui-flex__item" i="2">杂志</div>
		  	<div class="line_box">
		  		<div class="line twoTab"></div>
		  	</div>
		</div>
		<div class="tutor_box">
			<div class="page_content introduce" style="display: block;">
				<!-- 导师标签 -->
				<div class="tutor_label">
					<span>85后</span>
					<span>情感问题</span>
					<span>职场压力</span>
					<span>考前咨询</span>
					<span>情感问题</span>
					<span>职场压力</span>
					<span>85后</span>
				</div>
				<!-- 个人简介 -->
				<div class="introduce_card">
					<p class="title">个人简介</p>
					<div class="card_cont">
						<p>2005年从事心理治疗10余年，累计时数超过2000小时</p>
						<p>国家二级心理咨询师，中国心理学学会会员，国内资深婚恋服务专家，心理督导师。</p>
						<p>2005年3月接受台湾大学晏涵文培训</p>
						<p>2007年4月接受毕希明教授心理咨询培训</p>
						<p>2009--2010年珍爱网情感导师 </p>
						<p>2013--2014教授张德芬教授心理咨询私教课。</p>
					</div>
				</div>
				<!-- 用户评价 -->
				<div class="introduce_card">
					<p class="title">用户评价<span>(20)</span></p>
					<div class="card_cont user_evaluation">
						<div class="evaluation_link">
							<a href="javascript:;" class="evaluation_active">全部</a>
							<a href="javascript:;">专业</a>
							<a href="javascript:;">响应迅速</a>
							<a href="javascript:;">和蔼可亲</a>
							<a href="javascript:;">耐心</a>
							<a href="javascript:;">声音甜美</a>
						</div>
					</div>
					<div class="evaluation_ul weui-cells">
						<div class="evaluation_li">
							<div class="weui-cell">
							    <div class="weui-cell__hd"><img src="images/timg-head.jpg"></div>
							    <div class="weui-cell__bd">
							      	<p>
							      		<span class="name">Menty</span>
							      		<span class="star_box">
							      			<i class="on_star"></i>
							      			<i class="on_star"></i>
							      			<i class="on_star"></i>
							      			<i class="on_star"></i>
							      			<i class="off_star"></i>
							      		</span>
							      	</p>
							      	<p class="evaluation_time">2018-04-01 13:00</p>
							    </div>
							    <div class="weui-cell__ft">单次-通话咨询</div>
							</div>
							<div class="evaluation_text">
								感情上遇到一些问题，没有办法自我消化了，所以来到网上找心理咨询师，很幸运地选了梦立方，更幸运的是客服帮我匹配了石杨晓雪老师
							</div>
							<div class="evaluation_review">
								<p class="review_title">用户12天后追评</p>
								<p class="review_cont">
									老师真的是太棒了，完全解决了我的疑虑，感谢老师的帮助，真的非常感谢！
								</p>
							</div>
							<div class="tutor_reply">
								<div class="label">专家回复：</div>
								<div class="content">感谢您对我的信任和支持</div>
							</div>
						</div>
						<div class="evaluation_li">
							<div class="weui-cell">
							    <div class="weui-cell__hd"><img src="images/timg-head.jpg"></div>
							    <div class="weui-cell__bd">
							      	<p>
							      		<span class="name">Menty</span>
							      		<span class="star_box">
							      			<i class="on_star"></i>
							      			<i class="on_star"></i>
							      			<i class="on_star"></i>
							      			<i class="on_star"></i>
							      			<i class="off_star"></i>
							      		</span>
							      	</p>
							      	<p class="evaluation_time">2018-04-01 13:00</p>
							    </div>
							    <div class="weui-cell__ft">单次-通话咨询</div>
							</div>
							<div class="evaluation_text">
								感情上遇到一些问题，没有办法自我消化了，所以来到网上找心理咨询师，很幸运地选了梦立方，更幸运的是客服帮我匹配了石杨晓雪老师
							</div>
							<div class="tutor_reply">
								<div class="label">专家回复：</div>
								<div class="content">感谢您对我的信任和支持</div>
							</div>
						</div>
					</div>
					<a class="weui-cell weui-cell_access all_evaluation" href="javascript:;">
					    <div class="weui-cell__bd">
					      	<p>查看全部用户评价</p>
					    </div>
					    <div class="weui-cell__ft"></div>
					</a>
				</div>
			</div>
			<div class="page_content course magazine" id="mescroll">
				<ul id="dataList">
					
				</ul>
			</div>
			<p class="loadMore_box"><a href="javascript:;" class="loadMore">加载更多</a></p>
		</div>

		<div class="margin_num" style="height: 59px;"></div>
	</div>
	<div class="foot_fixed">
		<a href="javascript:;" class="weui-flex__item add_follow" onclick="functionList.followFn($(this))">+关注</a>
		<a href="javascript:;" class="weui-flex__item place_order">立即下单</a>
		<a href="javascript:;" class="weui-flex__item talk_privately">私聊</a>
	</div>

	<!-- body 最后 -->
	<script type="text/javascript" src="./js/jquery-2.1.4.js"></script>
	<script type="text/javascript" src="./js/jquery-weui.min.js"></script>
	<script type="text/javascript" src="./js/mescroll.js"></script>
	<script type="text/javascript" src="./js/swiper_weui.min.js"></script>
	<script type="text/javascript" src="./js/pdlist1.js"></script>
	<script type="text/javascript" src="./js/pdlist2.js"></script>
	<script type="text/javascript">
		$(function() {
			// 判断有无相册
			if (!$('.pic_swiper .swiper-slide').length) {
				$('.tutor_pic').hide();
			}

			var curNavIndex=0;//介绍0; 课程1; 杂志2;
			var totalPage,
				activePage;

			var tabTop = $('.top_tab').offset().top,
				topBoxH = $('.top_box').innerHeight(),
				tutorName = $('.tutor_data .name').text(),
				isBack = $('.top_box').find('a').hasClass('back'),
				isShare = $('.top_box').find('a').hasClass('share');
			$(window).scroll(function() {
				functionList.scroll_opacity($(this).scrollTop(), $('.top_box'), tutorName, isBack, isShare);
				if ($(this).scrollTop() >= (tabTop - topBoxH)) {
					$('.top_tab').css({
						position: 'fixed',
						top: topBoxH
					})
					$('.tutor_box').css({
						marginTop: 44 + 'px'
					})
				} else {
					$('.top_tab').css({
						position: 'relative',
						top: 0
					})
					$('.tutor_box').css({
						marginTop: 0 + 'px'
					})
				}
			})

			// tab切换
			var len = $('.top_tab .weui-flex__item').length,
				leftNum = 21, //初始距离左边的百分比
				$lineObj = $('.line_box .line');
			$('.top_tab .weui-flex__item').on('click', function() {
				var index = $(this).index();
				var i=Number($(this).attr("i"));

				if(curNavIndex!=i) {
					$('.loadMore_box').hide();
					$('#mescroll').hide();
					$('.introduce').show();
					functionList.changeLine(index, len, leftNum, $lineObj);
					$(this).addClass('active_tab').siblings().removeClass('active_tab');
					//显示对应的列表
					curNavIndex=i;
					if (curNavIndex!==0) {
						//重置列表数据
						mescroll.resetUpScroll();
						$('.introduce').hide();
						$('#mescroll').show();
						totalPage = 2;
					}
				}
			})

			$('.loadMore').on('click', function() {
				mescroll.triggerUpScroll();
			})

			//创建MeScroll对象,内部已默认开启下拉刷新,自动执行up.callback,刷新列表数据;
			var mescroll = new MeScroll("mescroll", { //id固定"body"
				down: {
					use: false
				},
				//上拉加载的配置项
				up: {
					callback: getListData, //上拉回调,此处可简写; 相当于 callback: function (page) { getListData(page); }
					noMoreSize: 4, //如果列表已无数据,可设置列表的总数量要大于半页才显示无更多数据;避免列表数据过少(比如只有一条数据),显示无更多数据会不好看; 默认5
					clearEmptyId: "dataList" //相当于同时设置了clearId和empty.warpId; 简化写法;默认null
				}
			});

			/*联网加载列表数据  page = {num:1, size:10}; num:当前页 从1开始, size:每页数据条数 */
			function getListData(page){
				//联网加载数据
				console.log("curNavIndex="+curNavIndex+", page.num="+page.num);
				activePage = page.num;
				getListDataFromNet(curNavIndex, page.num, page.size, function(data){
					//联网成功的回调,隐藏下拉刷新和上拉加载的状态;
					console.log("data.length="+data.length);
					mescroll.endSuccess(data.length);
					//设置列表数据
					setListData(data);
				}, function(){
					//联网失败的回调,隐藏下拉刷新和上拉加载的状态;
	                mescroll.endErr();
				});
			}

			/*设置列表数据*/
			function setListData(data){

				// var listDom=document.getElementById("dataList"+curNavIndex);
				var $listDom=$('#dataList');

				for (var i = 0; i < data.length; i++) {
					
					if (curNavIndex == 1) {
						var str = courseHtmlFn(data[i]);
					} else if (curNavIndex == 2) {
						var str = magazineHtmlFn(data[i]);
					}

					$listDom.append(str);
				}
			}

			/*联网加载列表数据*/
			function getListDataFromNet(curNavIndex,pageNum,pageSize,successCallback,errorCallback) {
				//延时一秒,模拟联网
                setTimeout(function () {
             		// $.ajax({
		             //    type: 'GET',
		             //    url: 'xxx',
		             //    url: 'data.json?curNavIndex='+curNavIndex+'&num='+pageNum+'&size='+pageSize,
		             //    dataType: 'json',
		             //    success: function(data){
		                	var data;
		                	var listData=[];
		                	if (activePage >= totalPage) {
		                		$('.loadMore_box').hide();
		                	} else {
		                		$('.loadMore_box').show();
		                	}
		                	if(curNavIndex==1){
		                		data = pdlist1;
		                		//全部 (模拟分页数据)
								for (var i = (pageNum-1)*pageSize; i < pageNum*pageSize; i++) {
				            		if(i==data.length) break;
				            		listData.push(data[i]);
				            	}
								
		                	}else if(curNavIndex==2){
		                		data = pdlist2;
		                		//全部 (模拟分页数据)
								for (var i = (pageNum-1)*pageSize; i < pageNum*pageSize; i++) {
				            		if(i==data.length) break;
				            		listData.push(data[i]);
				            	}
		                		
		                	}
		                	
		                	//回调
		                	successCallback(listData);
		            //     },
		            //     error: errorCallback
		            // });
                },400)
			}
			
			//禁止PC浏览器拖拽图片,避免与下拉刷新冲突;如果仅在移动端使用,可删除此代码
			document.ondragstart=function() {return false;}

			// swiper
			var picItems = [
				"images/timg-head.jpg",
			    "images/bg.jpg",
			    "images/timg2.jpg",
			    "images/rule_case2.png"
		    ]
			var picSwiper = new Swiper('.pic_swiper', {
		        slidesPerView: 3.2,
		        breakpoints: { 
				    //当宽度小于等于480
				    480: {
				      spaceBetween: 10
				    },
				   //当宽度小于等于750
				    750: { 
				      spaceBetween: 20
				    },
				    //当宽度小于等于1242
				    1242: {
				      spaceBetween: 30
				    }
				},
				onTap: function(swiper){
					var pic = $.photoBrowser({
						items: picItems,
						initIndex: swiper.clickedIndex
					});
					pic.open()
			    }
		    });

		    // 点击评价分类
		    $(document).on('click', '.evaluation_link a', function() {
		    	$(this).addClass('evaluation_active').siblings().removeClass('evaluation_active');
		    })
		})

		function courseHtmlFn(data) {
	    	var divs = "";
    		divs += '<div class="adolesce_list">';
    		divs += '<div class="adolesce_binner" style="background-image: url('+data.img+');">';
    		divs += '<div class="play_icon"></div>';
    		divs += '</div>';
    		divs += '<div class="title">'+data.title+'</div>';
    		divs += '<div class="data">';
    		divs += '<span>'+data.author+'</span>';
    		divs += '<span>'+data.num+'</span>';
    		divs += '<span>'+data.num+'</span>';
    		divs += '</div>';
    		divs += '<div class="price">¥ 18.9</div>';
    		divs += '</div>';
			return divs;
	    }

	    function magazineHtmlFn(data) {
	    	var divs = "";
    		divs += '<div class="weui-cell">';
    		divs += '<div class="weui-cell__bd">';
    		divs += '<p class="title">'+data.title+'</p>';
    		divs += '<p class="author">主讲：'+data.author+'</p>';
    		divs += '<p class="data">';
    		divs += '<label>专题</label>';
    		divs += '<span>'+data.num+'浏览</span>';
    		divs += '</p></div>';
    		divs += '<div class="weui-cell__ft"><img src="'+data.img+'"></div>';
    		divs += '</div>';
			return divs;
	    }

		var functionList = {
			// tab切换改变line位置
			changeLine: function(index, len, leftNum, $lineObj) {
				$lineObj.animate({
					left: ((100 / len) * index + leftNum).toFixed(2) + '%'
				}, 200);
			},
			// 滚动改变透明度
			scroll_opacity: function(scrollNum, $obj, tutorName, isBack, isShare) {
				if (scrollNum >= 150) {
					$obj.addClass('opacity_active');
					$obj.find('span').text(tutorName);
					if (isBack) {
						$obj.find('.back').css({
							background: 'url("./images/icon_top_back@2x.png") no-repeat center',
							backgroundSize: 'contain'
						})
					}
					if (isShare) {
						$obj.find('.share').css({
							background: 'url("./images/icon_top_share@2x.png") no-repeat center',
							backgroundSize: 'contain'
						})
					}
				} else {
					$obj.removeClass('opacity_active');
					$obj.find('span').text('');
					if (isBack) {
						$obj.find('.back').css({
							background: 'url("./images/back.png") no-repeat center',
							backgroundSize: 'contain'
						})
					}
					if (isShare) {
						$obj.find('.share').css({
							background: 'url("./images/icon_frequency_share@2x.png") no-repeat center',
							backgroundSize: 'contain'
						})
					}
				}
			},
			// 是否关注
			followFn: function($obj) {
				if ( $obj.hasClass('is_follow') ) {
					$obj.removeClass('is_follow');
					$obj.text('+关注');
					$.toast("已取消关注");
				} else {
					$obj.addClass('is_follow');
					$obj.text('已关注');
					$.toast("关注成功");
				}
			}
		}
	</script>
</body>
</html>